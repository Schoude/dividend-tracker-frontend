---
import PageNavigation from "../../components/PageNavigation.astro";
import Layout from "../../layouts/Layout.astro";
import type { ArticleNewsSentiment } from "../../utils/api/alphavantage";
import ArticleSentimentNews from "../../components/articles/ArticleSentimentNews.astro";
import { GET } from "../api/alphavantage/sentiment-news";

let response = await GET(Astro);

if (!response.body) {
  return Astro.redirect("/insights", 307);
}

const data = (await (response as Response).json()) as {
  articlesBullish: ArticleNewsSentiment[];
  articlesBearish: ArticleNewsSentiment[];
};
---

<Layout title="Sentiment News | Dividend Tracker">
  <PageNavigation>
    <a href="/portfolios/1">Portofolio-Ãœbersicht</a>
    <a href="/insights">Market Insights</a>
  </PageNavigation>

  <main>
    <h1>News Sentiment</h1>
    <section class="sentiment-positive">
      <h2>Positive</h2>
      {
        data.articlesBullish.map((article) => (
          <ArticleSentimentNews article={article} />
        ))
      }
    </section>

    <section class="sentiment-negative">
      <h2>Negative</h2>
      {
        data.articlesBearish.map((article) => (
          <article>
            <header>{article.title}</header>
            <p>{article.overall_sentiment_score}</p>
          </article>
        ))
      }
    </section>
  </main>
</Layout>

<script>
  console.log("adasd");
</script>
